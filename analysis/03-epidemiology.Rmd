---
title: "EPIDEMIOLOGICAL COVARIATES"
author: "Andree Valle Campos"
date: '`r Sys.Date()`'
output: 
  html_document:
#  pdf_document:
#  html_notebook:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
    code_folding: "hide"
#    number_sections: TRUE
#    df_print: kable
#    fig_caption: true
#  documentclass: report
bibliography: SeroMarker.bib
csl: american-medical-association.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, # CHANGE TO FALSE IN PDF_DOCUMENTS
                      warning = FALSE) 
knitr::opts_knit$set(root.dir = '../.') #gsub("/analysis","",getwd())
#getwd()
options(width = 110) # CHANGE TO DEFAULT in PDF
# FOR PDF CHANGE: html_document, toc_float, number_sections, echo, width
# FOR PDF add new page USE: four \newpage BEFORE #SETUP #APPENDIX #COMPUTER.env #REFERENCES
```

# Setup 

This report is writen in **R** [@R] within a `Rmarkdown` [@rmarkdown] notebook using the `RStudio` [@rstudio] IDE software, and employing the `knitr` [@knitr] and `Hmisc` [@Hmisc] packages for the `html` setup.

This dynamic document integrates **text**, **code** and **results**.

```{r setup0, results='hide', message=FALSE, eval=TRUE}
require(Hmisc)
#require(plotly)
#options(#grType='plotly',  # for certain graphics functions
#        width = 110) # to expand the limits of CONSOLE output
mu <- markupSpecs$html   # markupSpecs is in Hmisc

# The following hidden command (<code>r mu$widescreen()</code>), causes the html notebook to use an entire wide screen.
#mu$widescreen()
```
`r mu$widescreen()`

# Summary

**OBJECTIVE:**

* Principal: 
    - Standardize the OD~450nm~ values across ELISA plates by the estimation of the Antibody Units of each unknown sample.

* Secondary:
    - Implement a [reproducible workflow](https://www.ncbi.nlm.nih.gov/pubmed/26776185) for standardization of ELISA plates from a template matrix.


# Introduction

This is an R implementation of a pipeline for the standardization of ELISA plates directly from a template matrix.


# Dependencies

The required R packages for this analysis are:

+ XLConnect [@XLConnect]
+ drc [@Ritz2015]

```{r, results='hide', message=FALSE}
##essential
library(XLConnect)    # load EXCEL workbooks
library(drc)          # Dose-Response modeling
##accesory
library("DiagrammeR") # method Flowchart
library("knitr")      # To display nice tables
library("tidyverse")
#ggplot2, tibble, tidyr, readr, purr, dplyyr
##extra
library("Rmisc")      # multiplot ggplots
library("haven")      # import STATA df
library("readxl")     # import EXCEL df
library("forcats")    # factor vectors
library("viridis")    # color visualization
```

# read .Rds
```{r}
final <- readRDS("data/02-standard-tidy.rds")
finalDB <- readRDS("data/02-standard-untidy.rds")
```

- total amount of observations **`r length(final$ID)`**
- total amount of evaluated patients **`r length(levels(final$ID))`**
- giving **`r length(finalDB$ID)`** available samples in the `finalDB`.

# Epidemiological Covariates

```{bash}
ls -sh data/UNAP-*
```

## UNAP-6-EPI-08feb2017.xlsx
```{r}
#check sheets
readxl::excel_sheets("data/UNAP-6-EPI-08feb2017.xlsx")
```

### sheet 1
```{r}
#read xl
#read xl
unap6 <- readxl::read_excel("data/UNAP-6-EPI-08feb2017.xlsx", sheet = 1)
#filter NA
unap6 <- unap6[1:sum(unap6$id_integrante != "", na.rm = T), 
           1:sum(colnames(unap6) != "", na.rm= T)]
#963x109
colnames(unap6)
str(unap6)
summary(unap6)
```
```{r}
unap6
```

```{r}
#unap6a <- 
  unap6 %>%
  rename(id=id_integrante, 
         community=barrio, 
         age= Edad,
         residence= anios_residencia,
         sex=sexo) %>%
  mutate(sex=fct_recode(sex, M="m"), 
         nivel_educacion=fct_recode(nivel_educacion, 
                                    "Tecnica Completa"="TÃƒÂ©cnica Completa",
                                    "Tecnica Incompleta"="TÃƒÂ©cnica Incompleta"),
         fuente_agua=fct_recode(fuente_agua,
                                "3. Tuberia publica, fuente fuera de la casa, compartido con la comunidad"="3. TuberiƒÂa publica, fuente fuera de la casa, compartido con la comunidad"),
         banio_contectado=fct_recode(banio_contectado,
                                     "0. No tiene banio"="0. No tiene baÃ±o"),
         recibio_tratamiento_malaria=fct_recode(recibio_tratamiento_malaria,
                                                "1. Mas de una vez (especifique)"="1.Mas de una vez (especifique)",
                                                "1. Mas de una vez (especifique)"="1. MAs de una vez (especifique)",
                                                "1. Mas de una vez (especifique)"="1. MÃ¡s de una vez (especifique)"),
         no_busco_ayuda_tratamiento=fct_recode(no_busco_ayuda_tratamiento,
                                               "0. No pensaba que era un problema serio"="0. No pensa que era un problema serio",
                                               "0. No pensaba que era un problema serio"="0. No pensÃƒÆ’Ã‚Â³ que era un problema serio")
         ) %>%
  mutate_each(funs(factor), 3) %>%
  str()
  #count(tipo_trabajo)
  #count(combustible_cocinar)
  #count(material_paredes)
  #count(material_piso)
  #count(fuente_agua)
  #count(recibio_tratamiento_malaria)
  #count(drogras_tratamiento_01) #--------------------dirty
  #count(drogras_tratamiento_02) #--------------------dirty
  #count(fecha_registro) #--------------------------------------lubridate
  #count(epi_especie_causo_malaria) %>%
  #mutate(prop=n/sum(n))
```

```{r}
unap6 %>% 
  tidyr::separate(fecha_registro, 
                  c("date", "time", "mer"), 
                  sep = " ") %>% 
  dplyr::select(date, time, mer)
```


## age checkpoint
```{r}
unap6a %>%
  #ggplot(aes(Edad)) + geom_histogram()
  #ggplot(aes(anios_residencia)) + geom_histogram()
  group_by(age, residence) %>%
  summarise(n=n()) %>%
  mutate(prop= n/sum(n)) %>%
  ggplot(aes(age, residence, colour=prop)) + 
  geom_point() + 
  scale_color_viridis() #+
  #facet_grid(. ~ community) #+ theme_bw() # 3D CONTINUOUS VARIABLE PLOT
```

## malaria checkout
```{r}
unap6a %>%
  ggplot(aes(cuantas_tenido_malaria)) + geom_histogram()
```
```{r}
unap6a %>%
  group_by(tenido_malaria, opciones_tenido_malaria) %>%
  summarise(n=n())
```
```{r}
unap6a %>%
  group_by(tenido_malaria, opciones_tenido_malaria, cuantas_tenido_malaria) %>%
  summarise(n=n()) %>%
  filter(tenido_malaria!="Si" | opciones_tenido_malaria!="Si")
```


## problems

covariates with:

- **'otros_...'**
    + delete "otros""
    + merge both covariates
- **"enf_..._si"** and **"enf_..._no"**
    + merge both covariates
    

### sheet 2

### sheet 3

